<!DOCTYPE html>
<html>
<head>
    <title>Billing Smoke Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîê Billing System Smoke Test</h1>
    
    <div class="test">
        <h3>Test 1: Check Plan Status (Authenticated)</h3>
        <button onclick="testPlan()">Test /auth/api/me/plan</button>
        <div id="planResult" class="result"></div>
    </div>

    <div class="test">
        <h3>Test 2: Check Unauthenticated Access</h3>
        <button onclick="testUnauth()">Test Unauthenticated</button>
        <div id="unauthResult" class="result"></div>
    </div>

    <div class="test">
        <h3>Test 3: Check User Info</h3>
        <button onclick="testUser()">Test /api/me</button>
        <div id="userResult" class="result"></div>
    </div>

    <script>
        async function testPlan() {
            const result = document.getElementById('planResult');
            try {
                const response = await fetch('/auth/api/me/plan', { 
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const headers = {
                    status: response.status,
                    cors: response.headers.get('access-control-allow-origin'),
                    cache: response.headers.get('cache-control'),
                    contentType: response.headers.get('content-type')
                };
                
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `‚úÖ SUCCESS\nStatus: ${response.status}\nData: ${JSON.stringify(data, null, 2)}\nHeaders: ${JSON.stringify(headers, null, 2)}`;
                } else {
                    const text = await response.text();
                    result.innerHTML = `‚ùå ERROR\nStatus: ${response.status}\nBody: ${text}\nHeaders: ${JSON.stringify(headers, null, 2)}`;
                }
            } catch (error) {
                result.innerHTML = `üí• EXCEPTION: ${error.message}`;
            }
        }

        async function testUnauth() {
            const result = document.getElementById('unauthResult');
            try {
                const response = await fetch('/auth/api/me/plan', { 
                    credentials: 'omit' // No cookies
                });
                
                const headers = {
                    status: response.status,
                    cors: response.headers.get('access-control-allow-origin'),
                    cache: response.headers.get('cache-control')
                };
                
                const text = await response.text();
                result.innerHTML = `Response: ${response.status}\nBody: ${text}\nHeaders: ${JSON.stringify(headers, null, 2)}`;
            } catch (error) {
                result.innerHTML = `Exception: ${error.message}`;
            }
        }

        async function testUser() {
            const result = document.getElementById('userResult');
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                const data = await response.json();
                result.innerHTML = `User: ${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `Exception: ${error.message}`;
            }
        }

        // Auto-run tests on page load
        window.onload = () => {
            console.log('üß™ Billing smoke test page loaded');
            console.log('üìù Manual test commands:');
            console.log("fetch('/auth/api/me/plan', { credentials: 'include' }).then(r => r.json()).then(console.log)");
            console.log("fetch('/auth/api/me/plan', { credentials: 'omit' }).then(r => ({ status: r.status, headers: Object.fromEntries(r.headers) })).then(console.log)");
        };
    </script>
</body>
</html>