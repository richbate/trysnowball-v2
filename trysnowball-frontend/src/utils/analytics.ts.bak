import { localDebtStore } from '../data/localDebtStore';

export async function capturePlanView() {
 const debts = await localDebtStore.listDebts();
 const total = debts.reduce((s,d)=> s + (d.amount_pennies??0)/100, 0);
 
 // Dev logging to verify IndexedDB source
 if (process.env.NODE_ENV === 'development') {
  console.log('[analytics] plan totals sent from IDB:', { total, count: debts.length });
 }
 
 window.posthog?.capture?.('page_view', {
  page: 'my-plan',
  debtCount: debts.length,
  totalDebt: Math.round(total),
 });
}

// General PostHog capture helper with null safety
export function capture(event: string, props?: Record<string, any>) {
 try { 
  window.posthog?.capture?.(event, props); 
 } catch {}
}

// Upgrade funnel event constants
export const UPGRADE_EVENTS = {
 pageViewed: 'upgrade_page_viewed',
 checkoutStarted: 'checkout_started',
 checkoutFailed: 'checkout_failed',
 checkoutCompleted: 'checkout_completed',
};